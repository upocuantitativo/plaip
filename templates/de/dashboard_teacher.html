{% extends "base.html" %}

{% block title %}Lehrkraft-Dashboard{% endblock %}

{% block head %}
<style>
    .signal-card {
        border-radius: 15px;
        transition: all 0.3s;
    }
    .signal-card:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
    .metric-value { font-size: 2.5rem; font-weight: 700; }
    .trend-up { color: #28a745; }
    .trend-down { color: #dc3545; }
    .student-row:hover { background: #f8f9fa; }
    .alert-badge { position: absolute; top: -5px; right: -5px; }
    .pattern-indicator {
        width: 10px; height: 10px; border-radius: 50%;
        display: inline-block; margin-right: 5px;
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('landing', lang=lang) }}">Projekt</a></li>
                <li class="breadcrumb-item">Dashboards</li>
                <li class="breadcrumb-item active">Lehrkraft-Dashboard</li>
            </ol>
        </nav>
        <h1><i class="bi bi-person-workspace text-primary"></i> Lehrkraft-Dashboard</h1>
        <p class="text-muted lead">
            Visualisierung beobachtbarer Lernsignale. Verfolgen Sie den Fortschritt der Lernenden, erkennen Sie Lernmuster
            und treffen Sie fundierte paedagogische Entscheidungen.
        </p>
    </div>
</div>

<!-- Teacher Role Alert -->
<div class="alert alert-info mb-4">
    <div class="row align-items-center">
        <div class="col-auto">
            <i class="bi bi-person-check fs-3"></i>
        </div>
        <div class="col">
            <strong>Lehrkraftzentrierter Ansatz:</strong> Die Plattform stellt Daten und Vorschlaege bereit,
            aber die endgueltige paedagogische Entscheidung liegt immer bei Ihnen. KI unterstuetzt Ihr
            professionelles Urteil, ersetzt es aber nicht.
        </div>
    </div>
</div>

<!-- Overview Metrics -->
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="card signal-card h-100 border-0 shadow-sm">
            <div class="card-body text-center">
                <div class="metric-value text-primary">{{ num_students }}</div>
                <p class="text-muted mb-0">Aktive Lernende</p>
                <small class="trend-up"><i class="bi bi-arrow-up"></i> 2 diese Woche</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card signal-card h-100 border-0 shadow-sm">
            <div class="card-body text-center">
                <div class="metric-value text-success">68%</div>
                <p class="text-muted mb-0">Durchschn. Abschlussrate</p>
                <small class="trend-up"><i class="bi bi-arrow-up"></i> +5% ggue. letzter Woche</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card signal-card h-100 border-0 shadow-sm">
            <div class="card-body text-center">
                <div class="metric-value text-warning">3</div>
                <p class="text-muted mb-0">Warnungen</p>
                <small class="text-muted">Lernende, die Aufmerksamkeit benoetigen</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card signal-card h-100 border-0 shadow-sm">
            <div class="card-body text-center">
                <div class="metric-value text-info">24</div>
                <p class="text-muted mb-0">Abgeschlossene Aktivitaeten</p>
                <small class="text-muted">Heute ueber alle Lernenden</small>
            </div>
        </div>
    </div>
</div>

<!-- Observable Learning Signals -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-broadcast me-2"></i>Beobachtbare Lernsignale</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6 class="text-muted mb-3">Antwortmuster</h6>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <span class="pattern-indicator bg-success"></span>
                                Richtige Antworten: <strong>72%</strong>
                            </li>
                            <li class="mb-2">
                                <span class="pattern-indicator bg-warning"></span>
                                Teilweise richtige Antworten: <strong>18%</strong>
                            </li>
                            <li class="mb-2">
                                <span class="pattern-indicator bg-danger"></span>
                                Falsche Antworten: <strong>10%</strong>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-muted mb-3">Engagement-Kennzahlen</h6>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="bi bi-arrow-repeat text-info me-2"></i>
                                Durchschn. Versuche pro Aktivitaet: <strong>1,8</strong>
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-clock text-warning me-2"></i>
                                Durchschn. Zeit pro Aktivitaet: <strong>12 Min.</strong>
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-pencil text-primary me-2"></i>
                                Antwort-Ueberarbeitungen: <strong>23%</strong>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-muted mb-3">Fortschritt</h6>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="bi bi-check-circle text-success me-2"></i>
                                Im Plan: <strong>{{ (students|length * 0.6)|int }} Lernende</strong>
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-exclamation-circle text-warning me-2"></i>
                                Braucht Unterstuetzung: <strong>{{ (students|length * 0.3)|int }} Lernende</strong>
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-x-circle text-danger me-2"></i>
                                Gefaehrdet: <strong>{{ (students|length * 0.1)|int }} Lernende</strong>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Student Overview Table -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-people me-2"></i>Fortschrittsuebersicht der Lernenden</h5>
                <div>
                    <select class="form-select form-select-sm" style="width: auto;">
                        <option>Alle Kompetenzen</option>
                        <option>Digital</option>
                        <option>Citizenship</option>
                        <option>Literacy</option>
                        <option>Numeracy</option>
                    </select>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Lernende/r</th>
                                <th>Profil</th>
                                <th>Fortschritt</th>
                                <th>Letzte Aktivitaet</th>
                                <th>Punktzahl</th>
                                <th>Status</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for student in students %}
                            <tr class="student-row">
                                <td>
                                    <strong>{{ student.name }}</strong>
                                    <br><small class="text-muted">{{ student.demographics.education_stage.name }}</small>
                                </td>
                                <td>
                                    {% if student.cognitive.prior_knowledge.digital > 60 %}
                                    <span class="badge bg-success">Leistungsstark</span>
                                    {% elif student.cognitive.prior_knowledge.digital > 40 %}
                                    <span class="badge bg-warning text-dark">Durchschnittlich</span>
                                    {% else %}
                                    <span class="badge bg-danger">Mit Schwierigkeiten</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="progress" style="height: 8px; width: 100px;">
                                        <div class="progress-bar bg-primary" style="width: {{ student.cognitive.prior_knowledge.digital }}%"></div>
                                    </div>
                                    <small>{{ student.cognitive.prior_knowledge.digital|int }}%</small>
                                </td>
                                <td><small>Vor 2 Stunden</small></td>
                                <td><strong>{{ (student.cognitive.prior_knowledge.digital * 0.9)|int }}</strong>/100</td>
                                <td>
                                    {% if student.emotional.intrinsic_motivation > 60 %}
                                    <span class="badge bg-success"><i class="bi bi-check-circle"></i> Im Plan</span>
                                    {% elif student.emotional.intrinsic_motivation > 40 %}
                                    <span class="badge bg-warning text-dark"><i class="bi bi-exclamation-circle"></i> Beobachten</span>
                                    {% else %}
                                    <span class="badge bg-danger"><i class="bi bi-x-circle"></i> Gefaehrdet</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary" title="Details anzeigen">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-info" title="Empfehlungen anzeigen">
                                        <i class="bi bi-lightbulb"></i>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row g-4 mb-4">
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-bar-chart me-2"></i>Fortschritt nach Kompetenz</h5>
            </div>
            <div class="card-body">
                <canvas id="skillChart" height="200"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-graph-up me-2"></i>Woechentlicher Fortschritt</h5>
            </div>
            <div class="card-body">
                <canvas id="progressChart" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Alerts Section -->
<div class="row">
    <div class="col-12">
        <div class="card border-warning">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0"><i class="bi bi-bell me-2"></i>Handlungsbedarf</h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <i class="bi bi-exclamation-triangle text-warning me-2"></i>
                            <strong>Lernende/r A</strong> - Geringe Beteiligung im Modul Digitale Kompetenzen
                            <br><small class="text-muted">3 Aktivitaeten in den letzten 2 Tagen abgebrochen</small>
                        </div>
                        <button class="btn btn-sm btn-outline-warning">Pruefen</button>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <i class="bi bi-graph-down text-danger me-2"></i>
                            <strong>Lernende/r B</strong> - Nachlassende Leistung in Citizenship
                            <br><small class="text-muted">Punktzahl in der letzten Woche um 15% gesunken</small>
                        </div>
                        <button class="btn btn-sm btn-outline-danger">Pruefen</button>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <i class="bi bi-clock text-info me-2"></i>
                            <strong>Lernende/r C</strong> - Verlaengerte Bearbeitungszeit bei Aktivitaeten
                            <br><small class="text-muted">Durchschnittliche Zeit 3x hoeher als bei Mitschueler/innen</small>
                        </div>
                        <button class="btn btn-sm btn-outline-info">Pruefen</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Skill Chart
const skillCtx = document.getElementById('skillChart').getContext('2d');
new Chart(skillCtx, {
    type: 'bar',
    data: {
        labels: ['Digital', 'Citizenship', 'Literacy', 'Numeracy'],
        datasets: [{
            label: 'Klassendurchschnitt',
            data: [72, 65, 78, 60],
            backgroundColor: ['#9C27B0', '#FF9800', '#4CAF50', '#2196F3']
        }]
    },
    options: {
        scales: { y: { beginAtZero: true, max: 100 } },
        plugins: { legend: { display: false } }
    }
});

// Progress Chart
const progressCtx = document.getElementById('progressChart').getContext('2d');
new Chart(progressCtx, {
    type: 'line',
    data: {
        labels: ['Woche 1', 'Woche 2', 'Woche 3', 'Woche 4', 'Woche 5'],
        datasets: [{
            label: 'Abschlussrate',
            data: [45, 52, 58, 62, 68],
            borderColor: '#0d6efd',
            tension: 0.3,
            fill: false
        }, {
            label: 'Durchschn. Punktzahl',
            data: [55, 60, 63, 67, 72],
            borderColor: '#28a745',
            tension: 0.3,
            fill: false
        }]
    },
    options: {
        scales: { y: { beginAtZero: true, max: 100 } }
    }
});
</script>
{% endblock %}
