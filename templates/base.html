<!DOCTYPE html>
<html lang="{{ lang|default('en') }}">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='img/favicon.svg') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='img/favicon-32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='img/favicon-16.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/favicon-180.png') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}InfiniteLearner{% endblock %}</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">

    <style>
        .logo-bar {
            background: #fff;
            padding: 10px 0;
            border-bottom: 3px solid #003399;
        }
        .logo-bar img {
            max-height: 50px;
            margin: 0 15px;
        }
        .eu-flag {
            max-height: 45px;
        }
        .navbar-brand-custom {
            font-weight: 700;
            font-size: 1.3rem;
        }
        .nav-wp-badge {
            font-size: 0.65rem;
            padding: 2px 5px;
            margin-left: 5px;
            vertical-align: middle;
        }
        .dropdown-menu {
            min-width: 280px;
        }
        .footer-logos img {
            max-height: 40px;
            margin: 0 10px;
            opacity: 0.8;
        }
        .eu-disclaimer {
            font-size: 0.75rem;
            color: #666;
            max-width: 600px;
            margin: 10px auto;
        }
    </style>

    {% block head %}{% endblock %}
</head>
<body>
    <!-- Language Selector Sidebar -->
    <div class="lang-sidebar">
        <a href="{{ request.path|replace('/' ~ lang ~ '/', '/es/') }}"
           class="lang-es {% if lang == 'es' %}active{% endif %}" title="Español">ES</a>
        <a href="{{ request.path|replace('/' ~ lang ~ '/', '/en/') }}"
           class="lang-en {% if lang == 'en' %}active{% endif %}" title="English">EN</a>
        <a href="{{ request.path|replace('/' ~ lang ~ '/', '/de/') }}"
           class="lang-de {% if lang == 'de' %}active{% endif %}" title="Deutsch">DE</a>
    </div>

    <!-- Logo Bar -->
    <div class="logo-bar">
        <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center flex-wrap">
                <div class="d-flex align-items-center">
                    <!-- UPO Logo -->
                    <img src="{{ url_for('static', filename='img/upo.jpg') }}" alt="Pablo de Olavide University"
                         onerror="this.outerHTML='<span class=\'badge bg-primary me-2\'>UPO</span>'">
                </div>
                <div class="text-center flex-grow-1">
                    <span class="fw-bold text-primary" style="font-size: 1.1rem;">
                        Erasmus+ KA3 - European Policy Experimentation
                    </span>
                </div>
                <div>
                    <!-- Erasmus+ Logo -->
                    <img src="{{ url_for('static', filename='img/erasmus.jpg') }}" alt="Co-funded by the European Union" class="eu-flag"
                         onerror="this.outerHTML='<span class=\'badge bg-warning text-dark\'>EU Co-funded</span>'">
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand navbar-brand-custom" href="{{ url_for('landing', lang=lang) }}">
                <i class="bi bi-infinity"></i> InfiniteLearner
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <!-- Project/Landing -->
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'landing' %}active{% endif %}" href="{{ url_for('landing', lang=lang) }}">
                            <i class="bi bi-house-heart"></i>
                            {% if lang == 'es' %}Proyecto{% elif lang == 'de' %}Projekt{% else %}Project{% endif %}
                        </a>
                    </li>

                    <!-- WP2 - Foundations -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle {% if request.endpoint in ['itinerary', 'framework'] %}active{% endif %}"
                           href="#" data-bs-toggle="dropdown">
                            <i class="bi bi-book"></i>
                            {% if lang == 'es' %}Fundamentos{% elif lang == 'de' %}Grundlagen{% else %}Foundations{% endif %}
                            <span class="badge bg-light text-primary nav-wp-badge">WP2</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><h6 class="dropdown-header">
                                {% if lang == 'es' %}WP2 - Fundamento Metodológico{% elif lang == 'de' %}WP2 - Methodische Grundlagen{% else %}WP2 - Methodological Foundation{% endif %}
                            </h6></li>
                            <li><a class="dropdown-item" href="{{ url_for('framework', lang=lang) }}">
                                <i class="bi bi-diagram-3 me-2"></i>
                                {% if lang == 'es' %}Marco Pedagógico Compartido{% elif lang == 'de' %}Gemeinsamer Pädagogischer Rahmen{% else %}Shared Pedagogical Framework{% endif %}
                            </a></li>
                            <li><a class="dropdown-item" href="{{ url_for('itinerary', lang=lang) }}">
                                <i class="bi bi-signpost-split me-2"></i>
                                {% if lang == 'es' %}Itinerarios de Aprendizaje{% elif lang == 'de' %}Lernpfade{% else %}Learning Pathways{% endif %}
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="{{ url_for('toolkit', lang=lang) }}">
                                <i class="bi bi-tools me-2"></i>
                                {% if lang == 'es' %}Kit de Herramientas para Docentes{% elif lang == 'de' %}Werkzeugkasten für Lehrkräfte{% else %}Toolkit for Teachers{% endif %}
                            </a></li>
                        </ul>
                    </li>

                    <!-- WP3 - Pilots -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle {% if request.endpoint in ['diagnostic', 'activities', 'evaluation', 'students_page'] %}active{% endif %}"
                           href="#" data-bs-toggle="dropdown">
                            <i class="bi bi-rocket-takeoff"></i>
                            {% if lang == 'es' %}Pilotos{% elif lang == 'de' %}Pilotprojekte{% else %}Pilots{% endif %}
                            <span class="badge bg-warning text-dark nav-wp-badge">WP3</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><h6 class="dropdown-header">
                                {% if lang == 'es' %}WP3 - Pilotos InfiniteLearner{% elif lang == 'de' %}WP3 - InfiniteLearner Pilotprojekte{% else %}WP3 - InfiniteLearner Pilots{% endif %}
                            </h6></li>
                            <li><a class="dropdown-item" href="{{ url_for('diagnostic', lang=lang) }}">
                                <i class="bi bi-clipboard2-pulse me-2"></i>
                                {% if lang == 'es' %}Diagnóstico Inicial{% elif lang == 'de' %}Eingangsdiagnose{% else %}Initial Diagnostic{% endif %}
                            </a></li>
                            <li><a class="dropdown-item" href="{{ url_for('activities', lang=lang) }}">
                                <i class="bi bi-puzzle me-2"></i>
                                {% if lang == 'es' %}Actividades de Aprendizaje{% elif lang == 'de' %}Lernaktivitäten{% else %}Learning Activities{% endif %}
                            </a></li>
                            <li><a class="dropdown-item" href="{{ url_for('evaluation', lang=lang) }}">
                                <i class="bi bi-check2-square me-2"></i>
                                {% if lang == 'es' %}Evaluación Formativa{% elif lang == 'de' %}Formative Bewertung{% else %}Formative Assessment{% endif %}
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="{{ url_for('students_page', lang=lang) }}">
                                <i class="bi bi-people me-2"></i>
                                {% if lang == 'es' %}Perfiles de Estudiantes{% elif lang == 'de' %}Schülerprofile{% else %}Student Profiles{% endif %}
                            </a></li>
                        </ul>
                    </li>

                    <!-- Dashboards -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle {% if request.endpoint in ['dashboard_teacher', 'dashboard_student', 'analytics'] %}active{% endif %}"
                           href="#" data-bs-toggle="dropdown">
                            <i class="bi bi-speedometer2"></i> Dashboards
                        </a>
                        <ul class="dropdown-menu">
                            <li><h6 class="dropdown-header">
                                {% if lang == 'es' %}Señales Observables de Aprendizaje{% elif lang == 'de' %}Beobachtbare Lernsignale{% else %}Observable Learning Signals{% endif %}
                            </h6></li>
                            <li><a class="dropdown-item" href="{{ url_for('dashboard_teacher', lang=lang) }}">
                                <i class="bi bi-person-workspace me-2"></i>
                                {% if lang == 'es' %}Panel del Docente{% elif lang == 'de' %}Lehrkräfte-Dashboard{% else %}Teacher Dashboard{% endif %}
                            </a></li>
                            <li><a class="dropdown-item" href="{{ url_for('dashboard_student', lang=lang) }}">
                                <i class="bi bi-mortarboard me-2"></i>
                                {% if lang == 'es' %}Panel del Estudiante{% elif lang == 'de' %}Schüler-Dashboard{% else %}Student Dashboard{% endif %}
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="{{ url_for('recommendations', lang=lang) }}">
                                <i class="bi bi-lightbulb me-2"></i>
                                {% if lang == 'es' %}Recomendaciones IA{% elif lang == 'de' %}KI-Empfehlungen{% else %}AI Recommendations{% endif %}
                            </a></li>
                        </ul>
                    </li>

                    <!-- WP4 - Consolidation -->
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'consolidation' %}active{% endif %}" href="{{ url_for('consolidation', lang=lang) }}">
                            <i class="bi bi-file-earmark-check"></i>
                            {% if lang == 'es' %}Resultados{% elif lang == 'de' %}Ergebnisse{% else %}Results{% endif %}
                            <span class="badge bg-success nav-wp-badge">WP4</span>
                        </a>
                    </li>

                    <!-- RL Simulation -->
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'simulation' %}active{% endif %}" href="{{ url_for('simulation', lang=lang) }}">
                            <i class="bi bi-cpu"></i>
                            {% if lang == 'es' %}Simulación RL{% elif lang == 'de' %}RL-Simulation{% else %}RL Simulation{% endif %}
                        </a>
                    </li>
                </ul>
                <span class="navbar-text">
                    <span class="badge bg-light text-primary">
                        <i class="bi bi-shield-check"></i>
                        {% if lang == 'es' %}Competencias Digitales + Ciudadanas{% elif lang == 'de' %}Digitale + Bürgerschaftliche Kompetenzen{% else %}Digital + Citizenship Skills{% endif %}
                    </span>
                </span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container-fluid py-4">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-light py-4 mt-auto">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-4 text-center text-md-start footer-logos">
                    <img src="{{ url_for('static', filename='img/upo.jpg') }}" alt="UPO"
                         onerror="this.style.display='none'">
                </div>
                <div class="col-md-4 text-center">
                    <p class="mb-1"><strong>InfiniteLearner</strong></p>
                    <small class="text-muted">
                        ERASMUS-EDU-2026-POL-EXP-T03-DIGITAL-BS
                    </small>
                </div>
                <div class="col-md-4 text-center text-md-end">
                    <img src="{{ url_for('static', filename='img/erasmus.jpg') }}" alt="EU" style="max-height: 35px;"
                         onerror="this.style.display='none'">
                </div>
            </div>
            <div class="eu-disclaimer text-center mt-3">
                <small>
                    {% if lang == 'es' %}
                    Cofinanciado por la Unión Europea. Los puntos de vista y las opiniones expresados son únicamente los del autor o autores
                    y no reflejan necesariamente los de la Unión Europea ni los de la Agencia Ejecutiva Europea de Educación y Cultura (EACEA).
                    Ni la Unión Europea ni la EACEA pueden ser consideradas responsables de ellos.
                    {% elif lang == 'de' %}
                    Kofinanziert von der Europäischen Union. Die geäußerten Ansichten und Meinungen entsprechen jedoch ausschließlich denen des Autors bzw. der Autoren
                    und spiegeln nicht zwingend die der Europäischen Union oder der Europäischen Exekutivagentur für Bildung und Kultur (EACEA) wider.
                    Weder die Europäische Union noch die EACEA können dafür verantwortlich gemacht werden.
                    {% else %}
                    Co-funded by the European Union. Views and opinions expressed are however those of the author(s) only
                    and do not necessarily reflect those of the European Union or the European Education and Culture Executive Agency (EACEA).
                    Neither the European Union nor EACEA can be held responsible for them.
                    {% endif %}
                </small>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Plotly -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>

    {% block scripts %}{% endblock %}
</body>
</html>
