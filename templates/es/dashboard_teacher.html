{% extends "base.html" %}

{% block title %}Panel del Profesor{% endblock %}

{% block head %}
<style>
    .signal-card {
        border-radius: 15px;
        transition: all 0.3s;
    }
    .signal-card:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
    .metric-value { font-size: 2.5rem; font-weight: 700; }
    .trend-up { color: #28a745; }
    .trend-down { color: #dc3545; }
    .student-row:hover { background: #f8f9fa; }
    .alert-badge { position: absolute; top: -5px; right: -5px; }
    .pattern-indicator {
        width: 10px; height: 10px; border-radius: 50%;
        display: inline-block; margin-right: 5px;
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('landing', lang=lang) }}">Proyecto</a></li>
                <li class="breadcrumb-item">Paneles</li>
                <li class="breadcrumb-item active">Panel del Profesor</li>
            </ol>
        </nav>
        <h1><i class="bi bi-person-workspace text-primary"></i> Panel del Profesor</h1>
        <p class="text-muted lead">
            Visualizacion de Senales de Aprendizaje Observables. Monitoriza el progreso de los estudiantes, identifica patrones de aprendizaje
            y toma decisiones pedagogicas informadas.
        </p>
    </div>
</div>

<!-- Alerta del Rol del Profesor -->
<div class="alert alert-info mb-4">
    <div class="row align-items-center">
        <div class="col-auto">
            <i class="bi bi-person-check fs-3"></i>
        </div>
        <div class="col">
            <strong>Enfoque centrado en el profesor:</strong> La plataforma proporciona datos y sugerencias,
            pero la decision pedagogica final siempre te corresponde a ti. La IA apoya, no reemplaza,
            tu juicio profesional.
        </div>
    </div>
</div>

<!-- Metricas Generales -->
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="card signal-card h-100 border-0 shadow-sm">
            <div class="card-body text-center">
                <div class="metric-value text-primary">{{ num_students }}</div>
                <p class="text-muted mb-0">Estudiantes Activos</p>
                <small class="trend-up"><i class="bi bi-arrow-up"></i> 2 esta semana</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card signal-card h-100 border-0 shadow-sm">
            <div class="card-body text-center">
                <div class="metric-value text-success">68%</div>
                <p class="text-muted mb-0">Tasa Media de Completado</p>
                <small class="trend-up"><i class="bi bi-arrow-up"></i> +5% vs semana pasada</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card signal-card h-100 border-0 shadow-sm">
            <div class="card-body text-center">
                <div class="metric-value text-warning">3</div>
                <p class="text-muted mb-0">Alertas</p>
                <small class="text-muted">Estudiantes que necesitan atencion</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card signal-card h-100 border-0 shadow-sm">
            <div class="card-body text-center">
                <div class="metric-value text-info">24</div>
                <p class="text-muted mb-0">Actividades Completadas</p>
                <small class="text-muted">Hoy entre todos los estudiantes</small>
            </div>
        </div>
    </div>
</div>

<!-- Senales de Aprendizaje Observables -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-broadcast me-2"></i>Senales de Aprendizaje Observables</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6 class="text-muted mb-3">Patrones de Respuesta</h6>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <span class="pattern-indicator bg-success"></span>
                                Respuestas correctas: <strong>72%</strong>
                            </li>
                            <li class="mb-2">
                                <span class="pattern-indicator bg-warning"></span>
                                Respuestas parciales: <strong>18%</strong>
                            </li>
                            <li class="mb-2">
                                <span class="pattern-indicator bg-danger"></span>
                                Respuestas incorrectas: <strong>10%</strong>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-muted mb-3">Metricas de Participacion</h6>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="bi bi-arrow-repeat text-info me-2"></i>
                                Intentos medios por actividad: <strong>1.8</strong>
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-clock text-warning me-2"></i>
                                Tiempo medio por actividad: <strong>12 min</strong>
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-pencil text-primary me-2"></i>
                                Revisiones de respuestas: <strong>23%</strong>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-muted mb-3">Progresion</h6>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="bi bi-check-circle text-success me-2"></i>
                                En buen camino: <strong>{{ (students|length * 0.6)|int }} estudiantes</strong>
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-exclamation-circle text-warning me-2"></i>
                                Necesita apoyo: <strong>{{ (students|length * 0.3)|int }} estudiantes</strong>
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-x-circle text-danger me-2"></i>
                                En riesgo: <strong>{{ (students|length * 0.1)|int }} estudiantes</strong>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tabla Resumen de Estudiantes -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-people me-2"></i>Resumen del Progreso de Estudiantes</h5>
                <div>
                    <select class="form-select form-select-sm" style="width: auto;">
                        <option>Todas las competencias</option>
                        <option>Digital</option>
                        <option>Citizenship</option>
                        <option>Literacy</option>
                        <option>Numeracy</option>
                    </select>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Estudiante</th>
                                <th>Perfil</th>
                                <th>Progreso</th>
                                <th>Ultima Actividad</th>
                                <th>Puntuacion</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for student in students %}
                            <tr class="student-row">
                                <td>
                                    <strong>{{ student.name }}</strong>
                                    <br><small class="text-muted">{{ student.demographics.education_stage.name }}</small>
                                </td>
                                <td>
                                    {% if student.cognitive.prior_knowledge.digital > 60 %}
                                    <span class="badge bg-success">Alto rendimiento</span>
                                    {% elif student.cognitive.prior_knowledge.digital > 40 %}
                                    <span class="badge bg-warning text-dark">Medio</span>
                                    {% else %}
                                    <span class="badge bg-danger">Con dificultades</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="progress" style="height: 8px; width: 100px;">
                                        <div class="progress-bar bg-primary" style="width: {{ student.cognitive.prior_knowledge.digital }}%"></div>
                                    </div>
                                    <small>{{ student.cognitive.prior_knowledge.digital|int }}%</small>
                                </td>
                                <td><small>Hace 2 horas</small></td>
                                <td><strong>{{ (student.cognitive.prior_knowledge.digital * 0.9)|int }}</strong>/100</td>
                                <td>
                                    {% if student.emotional.intrinsic_motivation > 60 %}
                                    <span class="badge bg-success"><i class="bi bi-check-circle"></i> En buen camino</span>
                                    {% elif student.emotional.intrinsic_motivation > 40 %}
                                    <span class="badge bg-warning text-dark"><i class="bi bi-exclamation-circle"></i> Monitorizar</span>
                                    {% else %}
                                    <span class="badge bg-danger"><i class="bi bi-x-circle"></i> En riesgo</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary" title="Ver detalles">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-info" title="Ver recomendaciones">
                                        <i class="bi bi-lightbulb"></i>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Fila de Graficos -->
<div class="row g-4 mb-4">
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-bar-chart me-2"></i>Progreso por Competencia</h5>
            </div>
            <div class="card-body">
                <canvas id="skillChart" height="200"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-graph-up me-2"></i>Progresion Semanal</h5>
            </div>
            <div class="card-body">
                <canvas id="progressChart" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Seccion de Alertas -->
<div class="row">
    <div class="col-12">
        <div class="card border-warning">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0"><i class="bi bi-bell me-2"></i>Atencion Requerida</h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <i class="bi bi-exclamation-triangle text-warning me-2"></i>
                            <strong>Estudiante A</strong> - Baja participacion en el modulo de Competencias Digitales
                            <br><small class="text-muted">3 actividades abandonadas en los ultimos 2 dias</small>
                        </div>
                        <button class="btn btn-sm btn-outline-warning">Revisar</button>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <i class="bi bi-graph-down text-danger me-2"></i>
                            <strong>Estudiante B</strong> - Rendimiento decreciente en Citizenship
                            <br><small class="text-muted">La puntuacion bajo un 15% en la ultima semana</small>
                        </div>
                        <button class="btn btn-sm btn-outline-danger">Revisar</button>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <i class="bi bi-clock text-info me-2"></i>
                            <strong>Estudiante C</strong> - Tiempo prolongado en actividades
                            <br><small class="text-muted">Tiempo medio 3 veces superior al de sus companeros</small>
                        </div>
                        <button class="btn btn-sm btn-outline-info">Revisar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Grafico de Competencias
const skillCtx = document.getElementById('skillChart').getContext('2d');
new Chart(skillCtx, {
    type: 'bar',
    data: {
        labels: ['Digital', 'Citizenship', 'Literacy', 'Numeracy'],
        datasets: [{
            label: 'Media de la Clase',
            data: [72, 65, 78, 60],
            backgroundColor: ['#9C27B0', '#FF9800', '#4CAF50', '#2196F3']
        }]
    },
    options: {
        scales: { y: { beginAtZero: true, max: 100 } },
        plugins: { legend: { display: false } }
    }
});

// Grafico de Progresion
const progressCtx = document.getElementById('progressChart').getContext('2d');
new Chart(progressCtx, {
    type: 'line',
    data: {
        labels: ['Semana 1', 'Semana 2', 'Semana 3', 'Semana 4', 'Semana 5'],
        datasets: [{
            label: 'Tasa de Completado',
            data: [45, 52, 58, 62, 68],
            borderColor: '#0d6efd',
            tension: 0.3,
            fill: false
        }, {
            label: 'Puntuacion Media',
            data: [55, 60, 63, 67, 72],
            borderColor: '#28a745',
            tension: 0.3,
            fill: false
        }]
    },
    options: {
        scales: { y: { beginAtZero: true, max: 100 } }
    }
});
</script>
{% endblock %}
